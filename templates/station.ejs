<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title> <%= station.name %> Metro Station </title>
    <link rel="icon" href="../images/AppIcon.png?v1" type="image/x-icon">
    <link rel="stylesheet" href="../styles/station.css">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/solid.min.css">
</head>
<body>
    <h1> <%= station.name %> Metro Station </h1>
    <h4> <%= station.address %> </h4>
    <div class="row"> 
        <div class="column"> 
            <h3> Arriving Trains </h3>
            <% nextTrains.map(({Line, Min, DestinationName, pathToDest}, i) => { %>
                <div class="row centered">
                    <svg class="chevron" onclick="toggleStops(<%= i %>)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"/></svg>
                    <span class="column <%= Line %> filled"> <%= Min %> 
                        <span class="minsLabel"> 
                            <% if (!(Min === "ARR") && !(Min === "BRD") && !(Min === "") ) { %>
                                mins
                            <% } %> 
                        </span> 
                    </span> 
                    <svg class="caret" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M246.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6l0 256c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l128-128z"/></svg>
                    &nbsp; <%= DestinationName %>
                </div>
                <div id="stops<%= i %>" class="stopsList" style="display: none;"> 
                    <% if (Line ==  "BL" && (station.name == "Huntington" || station.destination == "New Carrollton" || DestinationName == "Huntington" || DestinationName == "New Carrollton")) { %>
                        <div class="row"> <em>Please see blue line detour on map </em> </div>
                    <% } %>
                    <% pathToDest?.map(({ StationCode, StationName }) => { %>
                        <span class="<%= Line %> filled"> </span> <a href="/stations/<%= StationCode %>"> <%= StationName %>  </a> <br>
                    <% }) %> 
                </div>
            <% }) %>

            <% if (parkingInfo.length == 0) { %>
                <h3> No parking available </h3>
            <% } else {  %>
                <h3> Available Parking </h3>
                <div class="row"> 
                    All day: &nbsp; <%= parkingInfo[0].AllDayParking.TotalCount %>
                </div>
                <div class="row"> 
                    Metered:  &nbsp; <%= parkingInfo[0].ShortTermParking.TotalCount %>

                </div>
            <% } %>
        </div>
        <div class="column"> 
            <div id="img-magnifier-glass"> </div>
            <img id="metroMap" src="../images/MetroMap.jpg">
        </div>
    </div>
    <script> 
        /*********** Toggle Stops List *********/
        function toggleStops(index) {
            let stops = document.getElementById(`stops${index}`);
            let currentDisplay = stops.style.display; 
            stops.style.display = currentDisplay == "block" ? "none" : "block";
        }

        /*********** Image Magnifying *********/
        let img, glass, w, h, bw, zoom = 2.75;
        window.onload = (event) => {
            img = document.getElementById("metroMap");
            glass = document.getElementById("img-magnifier-glass");
            
            /* Set zoom for the magnifier glass */
            glass.style.backgroundSize = (img.width * zoom) + "px " + (img.height * zoom) + "px";
            
            bw = 3;
            w = glass.offsetWidth / 2;
            h = glass.offsetHeight / 2;

            /* Show/hide magnifier */
            glass.addEventListener("mousemove", moveMagnifier);
            img.addEventListener("mousemove", moveMagnifier);
            glass.addEventListener("mouseout", hideMagnifier);
            
            glass.addEventListener("touchmove", moveMagnifier);
            img.addEventListener("touchmove", moveMagnifier);

        };

        function moveMagnifier(e) {
            /* Prevent any other actions that may occur when moving over the image */
            e.preventDefault();

            /* Get the cursor's x and y positions: */
            const pos =  getCursorPos(e);
            let x = pos.x;
            let y = pos.y;

            if (x > img.width - (w / zoom)) {x = img.width - (w / zoom);}
            if (x < w / zoom) {x = w / zoom;}
            if (y > img.height - (h / zoom)) {y = img.height - (h / zoom);}
            if (y < h / zoom) {y = h / zoom;}

            /* Set the position of the magnifier glass: */
            glass.style.left = (x - w) + + window.pageXOffset + "px";
            glass.style.top = (y - h)  + window.pageYOffset + "px";

            /* Display what the magnifier glass "sees": */
            glass.style.visibility = "visible";
            glass.style.backgroundPosition = "-" + ((x * zoom) - w + bw) + "px -" + ((y * zoom) - h + bw) + "px";
            
        }

        function getCursorPos(e) {
            var a, x = 0, y = 0;
            e = e || window.event;
            /* Get the x and y positions of the image: */
            a = img.getBoundingClientRect();
            /* Calculate the cursor's x and y coordinates, relative to the image: */
            x = e.pageX - a.left;
            y = e.pageY - a.top;
            /* Consider any page scrolling: */
            x = x - window.pageXOffset;
            y = y - window.pageYOffset;
            return {x : x, y : y};
        }

        function hideMagnifier(e) {
            glass.style.visibility = "hidden";
        }
    </script>
</body>
</html>
